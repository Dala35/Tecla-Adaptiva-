<!DOCTYPE html>
<html lang="pt">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>TECLA Adapta PRIME â€“ IA Inclusiva</title>
  <style>
    body { margin:0; font-family:'Segoe UI', sans-serif; background:#121212; color:white; display:flex; flex-direction:column; height:100vh; font-size:18px;}
    header {background-color:#005b99; color:white; padding:1rem; text-align:center;}
    nav {display:flex; justify-content:space-between; background-color:#007acc; padding:0.5rem; flex-wrap:wrap;}
    nav button, #perfilSelect {background:transparent; border:none; color:white; padding:0.5rem 1rem; font-size:1rem; cursor:pointer; border-radius:6px;}
    nav button:hover, #perfilSelect:hover {background-color:#3399ff;}
    main.tab {flex:1; padding:1rem; overflow-y:auto;}
    .chat-container {display:flex; flex-direction:column; gap:0.5rem;}
    .user-msg, .bot-msg {max-width:75%; padding:0.75rem; border-radius:12px; font-size:18px; line-height:1.4;}
    .user-msg {align-self:flex-end; background-color:#1e88e5;}
    .bot-msg {align-self:flex-start; background-color:#ffb74d;}
    footer {padding:0.5rem; background:#222; display:flex; gap:0.5rem; flex-wrap:wrap; align-items:center;}
    input, select {flex:1; padding:0.75rem; font-size:1rem; border:1px solid #555; border-radius:6px; background:#333; color:white;}
    button.send, .emo-btn {padding:0.75rem 1rem; background:#0077cc; color:white; border:none; border-radius:6px; cursor:pointer; font-size:1rem;}
    .emo-btn {font-size:1.2rem; background-color:#005fa3;}
    button.send:hover, .emo-btn:hover {background-color:#004f8a;}
    table {width:100%; border-collapse:collapse; margin-top:1rem; font-size:0.9rem;}
    th, td {border:1px solid #555; padding:0.5rem; text-align:left;}
    th {background:#333;}
    tr:nth-child(even) {background:#1a1a1a;}
    tr:hover {background:#333;}
    .edit-btn, .delete-btn {cursor:pointer; padding:0.2rem 0.5rem; border:none; border-radius:4px;}
    .edit-btn {background:#ffa726; color:black;}
    .delete-btn {background:#e53935; color:white;}
  </style>
</head>
<body>
  <header>
    <h1>TECLA Adapta PRIME â€“ IA Inclusiva</h1>
  </header>

  <nav>
    <div>
      <button onclick="showTab('chat')">ğŸ’¬ Conversar</button>
      <button onclick="showTab('sobre')">â„¹ï¸ Sobre</button>
      <button onclick="showTab('ajuda')">ğŸ§­ Ajuda</button>
      <button onclick="showTab('gestao')">ğŸ—‚ï¸ GestÃ£o Conhecimento</button>
    </div>
    <div>
      <select id="perfilSelect" onchange="trocarPerfil()">
        <option value="padrao">ğŸ‘¤ PadrÃ£o</option>
        <option value="joao">JoÃ£o</option>
        <option value="maria">Maria</option>
      </select>
    </div>
  </nav>

  <main id="chat" class="tab">
    <div class="chat-container" id="chatBox"></div>
  </main>

  <main id="sobre" class="tab" style="display:none">
    <h2>Sobre o TECLA</h2>
    <p>TECLA Adapta Ã© um projeto de Dala De Carvalho, oferecendo apoio na comunicaÃ§Ã£o para pessoas com autismo ou dificuldades de expressÃ£o verbal.</p>
  </main>

  <main id="ajuda" class="tab" style="display:none">
    <h2>Como Usar</h2>
    <p>VocÃª pode digitar, falar ou clicar nos emojis para se comunicar. Se o TECLA nÃ£o souber uma resposta, ele perguntarÃ¡ se vocÃª deseja ensinÃ¡-lo. Ele aprende automaticamente.</p>
  </main>

  <main id="gestao" class="tab" style="display:none">
    <h2>Painel de GestÃ£o do Conhecimento</h2>
    <table id="knowledgeTable">
      <thead>
        <tr><th>Palavra/Frase</th><th>Resposta</th><th>AÃ§Ãµes</th></tr>
      </thead>
      <tbody></tbody>
    </table>
  </main>

  <footer>
    <input type="text" id="userInput" placeholder="Digite ou fale aqui..." onkeypress="if(event.key==='Enter') sendMessage()"/>
    <button class="send" onclick="sendMessage()">Enviar</button>
    <button class="send" onclick="startListening()">ğŸ™ï¸ Falar</button>
    <button class="emo-btn" onclick="quickSay('ğŸ™‚ Estou feliz')">ğŸ™‚</button>
    <button class="emo-btn" onclick="quickSay('ğŸ˜¢ Estou triste')">ğŸ˜¢</button>
    <button class="emo-btn" onclick="quickSay('ğŸ˜¡ Estou zangado')">ğŸ˜¡</button>
    <button class="emo-btn" onclick="quickSay('ğŸ§¡ Quero um abraÃ§o')">ğŸ§¡</button>
    <button class="emo-btn" onclick="quickSay('ğŸ½ï¸ Estou com fome')">ğŸ½ï¸</button>
    <button class="emo-btn" onclick="quickSay('ğŸš½ Preciso ir ao banheiro')">ğŸš½</button>
    <select id="vozSelect" title="Selecionar voz"></select>
    <button onclick="baixarDados()">â¬‡ï¸ Exportar</button>
    <button onclick="document.getElementById('backupFile').click()">â¬†ï¸ Importar</button>
    <input type="file" id="backupFile" style="display:none" onchange="lerBackup(this)">
  </footer>

<script>
let perfilAtual = "padrao";
let respostas = {};

async function carregarDados() {
  const res = await fetch('/data.json');
  respostas = await res.json();
  popularTabela();
}
carregarDados();

function showTab(id) {
  document.querySelectorAll("main.tab").forEach(el => el.style.display="none");
  document.getElementById(id).style.display="block";
}

function addMessage(msg, sender) {
  const el = document.createElement("div");
  el.className = sender==="user"?"user-msg":"bot-msg";
  el.textContent = msg;
  document.getElementById("chatBox").appendChild(el);
  document.getElementById("chatBox").scrollTop = document.getElementById("chatBox").scrollHeight;
}

function falar(texto){
  const synth = window.speechSynthesis;
  const utter = new SpeechSynthesisUtterance(texto);
  const voz = document.getElementById("vozSelect").value;
  if(voz) utter.voice = synth.getVoices().find(v=>v.name===voz);
  utter.lang="pt-PT";
  synth.speak(utter);
}

function sendMessage(){
  const input = document.getElementById("userInput");
  const texto = input.value.trim().toLowerCase();
  if(!texto) return;
  addMessage("ğŸ‘¤ "+texto, "user");

  if(respostas[texto]){
    addMessage("ğŸ¤– "+respostas[texto], "bot");
    falar(respostas[texto]);
  } else {
    const pergunta = "â“ NÃ£o sei responder. Deseja ensinar-me?";
    addMessage(pergunta, "bot");
    falar(pergunta);
    setTimeout(()=>{
      const ensino = prompt("Digite a resposta para: "+texto);
      if(ensino){
        respostas[texto] = ensino;
        fetch('/save', {method:'POST', headers:{'Content-Type':'application/json'}, body:JSON.stringify(respostas)});
        addMessage("âœ”ï¸ Aprendi: "+ensino, "bot");
        falar(ensino);
        popularTabela();
      }
    },500);
  }
  input.value="";
}

function quickSay(texto){document.getElementById("userInput").value=texto; sendMessage();}
function startListening(){
  const SpeechRecognition = window.SpeechRecognition || window.webkitSpeechRecognition;
  if(!SpeechRecognition){alert("Seu navegador nÃ£o suporta voz."); return;}
  const recognition = new SpeechRecognition();
  recognition.lang="pt-PT";
  recognition.onresult = e => {document.getElementById("userInput").value=e.results[0][0].transcript; sendMessage();}
  recognition.start();
}

function trocarPerfil(){
  perfilAtual=document.getElementById("perfilSelect").value;
  addMessage("ğŸ”„ Perfil alterado para: "+perfilAtual,"bot");
}

function baixarDados(){
  const blob = new Blob([JSON.stringify(respostas,null,2)],{type:"application/json"});
  const url = URL.createObjectURL(blob);
  const a=document.createElement("a"); a.href=url; a.download=`tecla_${perfilAtual}.json`; a.click();
}

function lerBackup(input){
  const reader = new FileReader();
  reader.onload = ()=>{ try{ respostas=JSON.parse(reader.result); popularTabela(); addMessage("âœ”ï¸ Backup restaurado!","bot"); }catch{alert("Erro ao importar arquivo.");} };
  reader.readAsText(input.files[0]);
}

function popularVozes(){
  const synth = window.speechSynthesis;
  const select = document.getElementById("vozSelect");
  synth.onvoiceschanged=()=>{
    select.innerHTML="";
    synth.getVoices().filter(v=>v.lang.includes("pt")).forEach(v=>{
      const opt=document.createElement("option");
      opt.value=v.name; opt.textContent=v.name; select.appendChild(opt);
    });
  };
}
popularVozes();

// === GestÃ£o do conhecimento ===
function popularTabela(){
  const tbody = document.querySelector("#knowledgeTable tbody");
  tbody.innerHTML="";
  for(const key in respostas){
    const tr=document.createElement("tr");
    tr.innerHTML=`<td>${key}</td><td>${respostas[key]}</td>
    <td>
      <button class="edit-btn" onclick="editarAprendizado('${key}')">Editar</button>
      <button class="delete-btn" onclick="deletarAprendizado('${key}')">Excluir</button>
    </td>`;
    tbody.appendChild(tr);
  }
}

function editarAprendizado(key){{
  "olÃ¡": "OlÃ¡! ğŸ˜Š Como vocÃª estÃ¡ hoje?",
  "bom dia": "Bom dia! Que seu dia seja incrÃ­vel! â˜€ï¸"
  "olÃ¡": "OlÃ¡! ğŸ˜Š Como vocÃª estÃ¡ hoje?",
  "bom dia": "Bom dia! Que seu dia seja incrÃ­vel! â˜€ï¸",
  "boa tarde": "Boa tarde! Espero que esteja aproveitando bem o dia! ğŸŒ¤ï¸",
  "boa noite": "Boa noite! Durma bem e tenha sonhos tranquilos. ğŸŒ™",
  "como vocÃª estÃ¡": "Estou bem, obrigado! E vocÃª? ğŸ¤–",
  "estou feliz": "Que bom! ğŸ˜„ Aproveite essa energia positiva!",
  "estou triste": "Sinto muito ğŸ˜¢ Espero que algo te anime em breve!",
  "estou zangado": "Respire fundo ğŸ˜¡ Tente se acalmar antes de agir.",
  "quero um abraÃ§o": "Aqui vai um abraÃ§o virtual! ğŸ§¡ğŸ¤—",
  "estou com fome": "Que tal preparar algo delicioso? ğŸ½ï¸",
  "preciso ir ao banheiro": "Ok! NÃ£o esqueÃ§a de se cuidar. ğŸš½",
  "estou cansado": "FaÃ§a uma pausa e descanse um pouco. ğŸ˜´",
  "estou ansioso": "Respire fundo, conte atÃ© 10 e vÃ¡ devagar. ğŸŒ¿",
  "me sinto sozinho": "Estou aqui com vocÃª. ğŸ¤",
  "tenho medo": "EstÃ¡ tudo bem sentir medo. Podemos falar sobre isso. ğŸ›¡ï¸",
  "nÃ£o entendi": "Tudo bem, posso explicar de outra forma. ğŸ”„",
  "preciso de ajuda": "Claro! Estou aqui para ajudar. ğŸ’¡",
  "ensinar nova palavra": "VocÃª pode me ensinar novas palavras e respostas usando o painel de conhecimento ou respondendo quando eu pedir.",
  "como usar": "VocÃª pode digitar, falar ou clicar nos emojis para se comunicar comigo. Se eu nÃ£o souber algo, posso aprender com vocÃª! ğŸ’¡",
  "como se comunicar comigo": "VocÃª pode digitar, usar voz ou clicar nos emojis para interagir comigo. ğŸ—£ï¸",
  "histÃ³ria de angola": "Angola Ã© um paÃ­s da Ãfrica Austral, com cultura rica em mÃºsica, danÃ§a e tradiÃ§Ãµes. ğŸ‡¦ğŸ‡´",
  "quem Ã© o dala": "Dala De Carvalho Ã© o criador do TECLA Adapta PRIME! ğŸ¨",
  "quem Ã© nelson mandela": "Nelson Mandela foi um lÃ­der sul-africano que lutou contra o apartheid e se tornou sÃ­mbolo mundial de paz e justiÃ§a. âœŠğŸ½",
  "o que Ã© autismo": "Autismo Ã© uma condiÃ§Ã£o neurolÃ³gica que afeta comunicaÃ§Ã£o, comportamento e interaÃ§Ã£o social de uma pessoa. ğŸ§©",
  "como lidar com autismo": "Seja paciente, use rotinas, ajude a reconhecer emoÃ§Ãµes e ofereÃ§a instruÃ§Ãµes claras. ğŸŒŸ",
  "rotina diÃ¡ria": "Vamos revisar juntos sua rotina: acordar, cafÃ© da manhÃ£, atividades, almoÃ§o, descanso e hobbies. â°",
  "hora de acordar": "Bom dia! Ã‰ hora de levantar! ğŸŒ",
  "hora de dormir": "Boa noite! Ã‰ hora de descansar. ğŸŒ™",
  "hora do lanche": "Ã‰ hora do lanche! ğŸ¥ª",
  "hora do banho": "Hora do banho! ğŸ›",
  "hora da escola": "Prepare-se! Ã‰ hora de estudar e aprender coisas novas. ğŸ“š",
  "hora do recreio": "Ã‰ hora de brincar e se divertir! ğŸƒâ€â™‚ï¸",
  "hora da medicaÃ§Ã£o": "Lembre-se de tomar sua medicaÃ§Ã£o se necessÃ¡rio. ğŸ’Š",
  "hora de se acalmar": "Vamos respirar fundo e relaxar por alguns minutos. ğŸŒ¿",
  "como se acalmar": "Respire fundo, conte atÃ© 10 e visualize algo agradÃ¡vel. ğŸŒˆ",
  "emoji feliz": "ğŸ™‚",
  "emoji triste": "ğŸ˜¢",
  "emoji zangado": "ğŸ˜¡",
  "emoji amor": "ğŸ§¡",
  "emoji fome": "ğŸ½ï¸",
  "emoji banheiro": "ğŸš½",
  "como pedir ajuda": "Diga 'preciso de ajuda' ou clique no botÃ£o de ajuda. ğŸ†˜",
  "como expressar sentimentos": "VocÃª pode usar palavras ou emojis para mostrar como se sente. ğŸ—¨ï¸",
  "como pedir abraÃ§o": "Diga 'quero um abraÃ§o' ou clique no emoji ğŸ§¡",
  "como pedir comida": "Diga 'estou com fome' ou clique no emoji ğŸ½ï¸",
  "como ir ao banheiro": "Diga 'preciso ir ao banheiro' ou clique no emoji ğŸš½",
  "como indicar cansaÃ§o": "Diga 'estou cansado' ou clique no emoji ğŸ˜´",
  "como indicar alegria": "Diga 'estou feliz' ou clique no emoji ğŸ™‚",
  "como indicar tristeza": "Diga 'estou triste' ou clique no emoji ğŸ˜¢",
  "como indicar raiva": "Diga 'estou zangado' ou clique no emoji ğŸ˜¡",
  "como indicar medo": "Diga 'tenho medo' ou clique no emoji ğŸ˜¨",
  "como indicar ansiedade": "Diga 'estou ansioso' ou clique no emoji ğŸ˜Ÿ",
  "como indicar solidÃ£o": "Diga 'me sinto sozinho' ou clique no emoji ğŸ¤",
  "como indicar dor": "Diga 'estou com dor' ou clique no emoji ğŸ¤•",
  "como indicar desconforto": "Diga 'estou desconfortÃ¡vel' ou clique no emoji ğŸ˜–",
  "como indicar sede": "Diga 'estou com sede' ou clique no emoji ğŸ¥¤",
  "como indicar calor": "Diga 'estou com calor' ou clique no emoji ğŸŒ",
  "como indicar frio": "Diga 'estou com frio' ou clique no emoji â„ï¸",
  "como indicar sono": "Diga 'estou com sono' ou clique no emoji ğŸ˜´",
  "como indicar amor": "Diga 'te amo' ou clique no emoji ğŸ§¡",
  "como indicar simpatia": "Diga 'gosto de vocÃª' ou clique no emoji ğŸ˜Š",
  "como indicar frustraÃ§Ã£o": "Diga 'estou frustrado' ou clique no emoji ğŸ˜",
  "como indicar entusiasmo": "Diga 'estou animado' ou clique no emoji ğŸ˜ƒ",
  "como indicar confusÃ£o": "Diga 'nÃ£o entendi' ou clique no emoji â“",
  "como indicar interesse": "Diga 'interessante' ou clique no emoji ğŸ¤”",
  "como indicar surpresa": "Diga 'surpreso' ou clique no emoji ğŸ˜²",
  "como indicar dÃºvida": "Diga 'nÃ£o sei' ou clique no emoji â“",
  "como indicar tranquilidade": "Diga 'estou calmo' ou clique no emoji ğŸ˜Œ",
  "como indicar empatia": "Diga 'entendo vocÃª' ou clique no emoji ğŸ¤",
  "como indicar tÃ©dio": "Diga 'estou entediado' ou clique no emoji ğŸ˜",
  "como indicar satisfaÃ§Ã£o": "Diga 'estou satisfeito' ou clique no emoji ğŸ˜„",
  "como indicar desaprovaÃ§Ã£o": "Diga 'nÃ£o gostei' ou clique no emoji ğŸ˜’",
  "como indicar aprovaÃ§Ã£o": "Diga 'gostei' ou clique no emoji ğŸ™‚",
  "como indicar curiosidade": "Diga 'quero aprender' ou clique no emoji ğŸ¤“",
  "como indicar vontade de brincar": "Diga 'quero brincar' ou clique no emoji ğŸ²",
  "como indicar vontade de ler": "Diga 'quero ler' ou clique no emoji ğŸ“–",
  "como indicar vontade de ouvir mÃºsica": "Diga 'quero ouvir mÃºsica' ou clique no emoji ğŸµ",
  "como indicar vontade de danÃ§ar": "Diga 'quero danÃ§ar' ou clique no emoji ğŸ’ƒ",
  "como indicar vontade de desenhar": "Diga 'quero desenhar' ou clique no emoji ğŸ¨",
  "como indicar vontade de escrever": "Diga 'quero escrever' ou clique no emoji âœï¸",
  "como indicar vontade de socializar": "Diga 'quero conversar' ou clique no emoji ğŸ—£ï¸",
  "como indicar vontade de ficar sozinho": "Diga 'quero ficar sozinho' ou clique no emoji ğŸ˜Œ",
  "como indicar prazer": "Diga 'isso Ã© bom' ou clique no emoji ğŸ˜„",
  "como indicar desgosto": "Diga 'nÃ£o gostei' ou clique no emoji ğŸ˜’",
  "como indicar conforto": "Diga 'estou confortÃ¡vel' ou clique no emoji ğŸ˜Œ",
  "como indicar desconforto": "Diga 'nÃ£o estou confortÃ¡vel' ou clique no emoji ğŸ˜–",
  "como indicar necessidade": "Diga 'preciso de ajuda' ou clique no emoji ğŸ†˜",
  "como indicar repetiÃ§Ã£o": "Diga 'repita por favor' ou clique no emoji ğŸ”„",
  "como indicar dÃºvida sobre tarefas": "Diga 'nÃ£o entendi a tarefa' ou clique no emoji â“",
  "como indicar querer ajuda para aprender": "Diga 'ajude-me a aprender' ou clique no emoji ğŸ¤",
  "como indicar querer ajuda emocional": "Diga 'preciso de apoio emocional' ou clique no emoji ğŸ’›",
  "como indicar querer rotina clara": "Diga 'preciso da minha rotina' ou clique no emoji â°",
  "como indicar vontade de brincar sozinho": "Diga 'quero brincar sozinho' ou clique no emoji ğŸ§©",
  "como indicar vontade de brincar com amigo": "Diga 'quero brincar com amigo' ou clique no emoji ğŸ¤—"
}
  const novo = prompt("Edite a resposta:", respostas[key]);
  if(novo){
    respostas[key]=novo;
    fetch('/save',{method:'POST',headers:{'Content-Type':'application/json'},body:JSON.stringify(respostas)});
    popularTabela();
  }
}

function deletarAprendizado(key){
  if(confirm("Deseja realmente excluir esta entrada?")){
    delete respostas[key];
    fetch('/save',{method:'POST',headers:{'Content-Type':'application/json'},body:JSON.stringify(respostas)});
    popularTabela();
  }
}
</script>
</body>
</html>
