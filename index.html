<!DOCTYPE html>
<html lang="pt">
<head>
<meta charset="UTF-8"/>
<meta name="viewport" content="width=device-width, initial-scale=1.0"/>
<title>TECLA Adapta PRIME ‚Äì IA Inclusiva</title>
<style>
  body{margin:0;font-family:'Segoe UI',sans-serif;background:#111;color:#fff;display:flex;flex-direction:column;height:100vh;font-size:18px}
  header{background:#005b99;padding:1rem;text-align:center;font-weight:bold;}
  nav{display:flex;justify-content:space-between;background:#007acc;padding:.5rem;flex-wrap:wrap;}
  nav button, #perfilSelect{background:transparent;border:none;color:white;padding:.5rem 1rem;font-size:1rem;cursor:pointer;border-radius:6px;}
  nav button:hover,#perfilSelect:hover{background-color:#3399ff;}
  main{flex:1;padding:1rem;overflow-y:auto;}
  .chat-container{display:flex;flex-direction:column;gap:.5rem;}
  .user-msg,.bot-msg{max-width:75%;padding:.75rem;border-radius:12px;font-size:18px;line-height:1.4;}
  .user-msg{align-self:flex-end;background-color:#0066cc;}
  .bot-msg{align-self:flex-start;background-color:#333;}
  footer{padding:.5rem;background:#222;display:flex;gap:.5rem;flex-wrap:wrap;align-items:center;}
  input,select{flex:1;padding:.75rem;font-size:1rem;border:1px solid #999;border-radius:6px;}
  button.send,.emo-btn{padding:.75rem 1rem;background:#0077cc;color:white;border:none;border-radius:6px;cursor:pointer;font-size:1rem;}
  .emo-btn{font-size:1.2rem;background-color:#005fa3;}
  button.send:hover,.emo-btn:hover{background-color:#004f8a;}
  table{width:100%;border-collapse:collapse;margin-top:1rem;color:#fff;}
  th,td{border:1px solid #555;padding:.3rem .5rem;text-align:left;font-family:monospace;}
  th{background:#222;}
  td button{background:red;color:#fff;border:none;padding:.2rem .5rem;border-radius:4px;cursor:pointer;}
</style>
</head>
<body>
<header>TECLA Adapta PRIME ‚Äì IA Inclusiva</header>
<nav>
  <div>
    <button onclick="showTab('chat')">üí¨ Conversar</button>
    <button onclick="showTab('sobre')">‚ÑπÔ∏è Sobre</button>
    <button onclick="showTab('painel')">üìä Gest√£o Conhecimento</button>
  </div>
  <div>
    <select id="perfilSelect" onchange="trocarPerfil()">
      <option value="padrao">üë§ Padr√£o</option>
      <option value="joao">Jo√£o</option>
      <option value="maria">Maria</option>
    </select>
  </div>
</nav>

<main id="chat" class="tab">
  <div class="chat-container" id="chatBox"></div>
</main>

<main id="sobre" class="tab" style="display:none">
  <h2>Sobre o TECLA</h2>
  <p>Projeto de apoio √† comunica√ß√£o de pessoas com autismo.</p>
</main>

<main id="painel" class="tab" style="display:none">
  <h2>Painel de Gest√£o do Conhecimento</h2>
  <table id="painelTable">
    <thead><tr><th>Frase</th><th>Resposta</th><th>A√ß√£o</th></tr></thead>
    <tbody></tbody>
  </table>
</main>

<footer>
  <input type="text" id="userInput" placeholder="Digite aqui..." onkeypress="if(event.key==='Enter') sendMessage()"/>
  <button class="send" onclick="sendMessage()">Enviar</button>
  <button class="send" onclick="startListening()">üéôÔ∏è Falar</button>
  <select id="vozSelect" title="Selecionar voz"></select>
</footer>

<script>
let perfilAtual="padrao";
let respostas={};
const chatBox=document.getElementById('chatBox');

async function carregarRespostas(){
  try{
    const resp=await fetch('/data.json');
    respostas=await resp.json();
    atualizarPainel();
  }catch(e){respostas={};}
}
carregarRespostas();

function showTab(id){
  document.querySelectorAll('main.tab').forEach(el=>el.style.display='none');
  document.getElementById(id).style.display='block';
}

function addMessage(msg,sender){
  const el=document.createElement('div');
  el.className=sender==='user'?'user-msg':'bot-msg';
  el.textContent=msg;
  chatBox.appendChild(el);
  chatBox.scrollTop=chatBox.scrollHeight;
}

function falar(texto){
  if(!texto) return;
  const synth=window.speechSynthesis;
  synth.cancel();
  const utter=new SpeechSynthesisUtterance(texto);
  utter.lang="pt-PT";
  synth.speak(utter);
}

function sendMessage(){
  const input=document.getElementById('userInput');
  const texto=input.value.trim();
  if(!texto) return;
  addMessage('üë§ '+texto,'user');

  let resposta=respostas[texto];

  if(!resposta){
    const chaves=Object.keys(respostas);
    for(let chave of chaves){
      if(texto.toLowerCase().includes(chave.toLowerCase())){
        resposta=respostas[chave];
        break;
      }
    }
  }

  if(resposta){
    addMessage('ü§ñ '+resposta,'bot');
    falar(resposta);
  }else{
    const pergunta='‚ùì N√£o sei responder. Deseja ensinar-me?';
    addMessage(pergunta,'bot');
    falar(pergunta);
    setTimeout(()=>{
      const ensino=prompt("Digite a resposta para: "+texto);
      if(ensino){
        respostas[texto]=ensino;
        salvarRespostas();
        addMessage("‚úîÔ∏è Aprendi: "+ensino,'bot');
        falar(ensino);
      }
    },500);
  }
  input.value='';
  atualizarPainel();
}

function startListening(){
  const SpeechRecognition=window.SpeechRecognition||window.webkitSpeechRecognition;
  if(!SpeechRecognition){alert("Seu navegador n√£o suporta voz.");return;}
  const recognition=new SpeechRecognition();
  recognition.lang="pt-PT";
  recognition.onresult=(event)=>{
    document.getElementById('userInput').value=event.results[0][0].transcript;
    sendMessage();
  };
  recognition.start();
}

function salvarRespostas(){
  fetch('/save',{
    method:'POST',
    headers:{'Content-Type':'application/json'},
    body:JSON.stringify(respostas)
  });
}

function trocarPerfil(){
  perfilAtual=document.getElementById('perfilSelect').value;
  carregarRespostas();
}

function atualizarPainel(){
  const tbody=document.querySelector('#painelTable tbody');
  tbody.innerHTML='';
  for(let chave in respostas){
    const tr=document.createElement('tr');
    const td1=document.createElement('td');
    td1.textContent=chave;
    const td2=document.createElement('td');
    td2.textContent=respostas[chave];
    const td3=document.createElement('td');
    const btn=document.createElement('button');
    btn.textContent='‚ùå';
    btn.onclick=()=>{delete respostas[chave];salvarRespostas();atualizarPainel();}
    td3.appendChild(btn);
    tr.appendChild(td1);tr.appendChild(td2);tr.appendChild(td3);
    tbody.appendChild(tr);
  }
}

// Popular vozes
function popularVozes(){
  const synth=window.speechSynthesis;
  synth.onvoiceschanged=()=>{ 
    const select=document.getElementById('vozSelect');
    select.innerHTML='';
    const vozes=synth.getVoices().filter(v=>v.lang.includes('pt'));
    vozes.forEach(v=>{
      const opt=document.createElement('option');
      opt.value=v.name;
      opt.textContent=v.name;
      select.appendChild(opt);
    });
  }
}
popularVozes();
</script>
</body>
</html>
