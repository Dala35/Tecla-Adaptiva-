<!DOCTYPE html>
<html lang="pt">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>TECLA Adapta PRIME â€“ IA Inclusiva</title>
<style>
  body { margin:0; font-family:'Segoe UI',sans-serif; background:#1e1e1e; color:#fff; display:flex; flex-direction:column; height:100vh; }
  header { background:#005b99; padding:1rem; text-align:center; }
  nav { display:flex; justify-content:space-between; background:#007acc; padding:0.5rem; flex-wrap:wrap; }
  nav button, #perfilSelect { background:transparent; border:none; color:white; padding:0.5rem 1rem; font-size:1rem; cursor:pointer; border-radius:6px; }
  nav button:hover, #perfilSelect:hover { background-color:#3399ff; }
  main { flex:1; padding:1rem; overflow-y:auto; }
  .tab { display:none; }
  .chat-container { display:flex; flex-direction:column; gap:0.5rem; }
  .user-msg, .bot-msg { max-width:75%; padding:0.75rem; border-radius:12px; font-size:1rem; line-height:1.4; }
  .user-msg { align-self:flex-end; background:#2a2a2a; }
  .bot-msg { align-self:flex-start; background:#333; }
  footer { padding:0.5rem; background:#222; display:flex; gap:0.5rem; flex-wrap:wrap; align-items:center; }
  input, select { flex:1; padding:0.75rem; font-size:1rem; border:1px solid #555; border-radius:6px; background:#111; color:#fff; }
  button.send, .emo-btn { padding:0.75rem 1rem; background:#0077cc; color:white; border:none; border-radius:6px; cursor:pointer; font-size:1rem; }
  .emo-btn { font-size:1.2rem; background-color:#005fa3; }
  button.send:hover, .emo-btn:hover { background-color:#004f8a; }
  /* Painel de gestÃ£o de conhecimento */
  table { width:100%; border-collapse:collapse; margin-top:1rem; }
  th, td { padding:0.5rem; border:1px solid #555; text-align:left; font-size:0.9rem; }
  th { background:#333; }
  td { background:#222; }
  button.edit, button.delete { padding:0.2rem 0.5rem; margin:0 0.2rem; cursor:pointer; font-size:0.8rem; border:none; border-radius:4px; }
  button.edit { background:#3399ff; color:#fff; }
  button.delete { background:#ff5555; color:#fff; }
</style>
</head>
<body>
<header>
  <h1>TECLA Adapta PRIME â€“ IA Inclusiva</h1>
</header>

<nav>
  <div>
    <button onclick="showTab('chat')">ğŸ’¬ Conversar</button>
    <button onclick="showTab('sobre')">â„¹ï¸ Sobre</button>
    <button onclick="showTab('ajuda')">ğŸ§­ Ajuda</button>
    <button onclick="showTab('painel')">ğŸ—‚ï¸ GestÃ£o</button>
  </div>
  <div>
    <select id="perfilSelect" onchange="trocarPerfil()">
      <option value="padrao">ğŸ‘¤ PadrÃ£o</option>
      <option value="joao">JoÃ£o</option>
      <option value="maria">Maria</option>
    </select>
  </div>
</nav>

<main id="chat" class="tab" style="display:block">
  <div class="chat-container" id="chatBox"></div>
</main>

<main id="sobre" class="tab">
  <h2>Sobre o TECLA</h2>
  <p>TECLA Adapta Ã© um projeto criado por Dala De Carvalho para apoio Ã  comunicaÃ§Ã£o de pessoas com autismo ou dificuldades verbais.</p>
</main>

<main id="ajuda" class="tab">
  <h2>Como Usar</h2>
  <p>Digite, fale ou clique nos emojis para interagir. Se eu nÃ£o souber algo, posso aprender!</p>
</main>

<main id="painel" class="tab">
  <h2>Painel de GestÃ£o do Conhecimento</h2>
  <table id="knowledgeTable">
    <thead>
      <tr><th>Chave</th><th>Resposta</th><th>AÃ§Ãµes</th></tr>
    </thead>
    <tbody></tbody>
  </table>
</main>

<footer>
  <input type="text" id="userInput" placeholder="Digite ou fale aqui..." onkeypress="if(event.key==='Enter') sendMessage()"/>
  <button class="send" onclick="sendMessage()">Enviar</button>
  <button class="send" onclick="startListening()">ğŸ™ï¸ Falar</button>
  <button class="emo-btn" onclick="quickSay('ğŸ™‚ Estou feliz')">ğŸ™‚</button>
  <button class="emo-btn" onclick="quickSay('ğŸ˜¢ Estou triste')">ğŸ˜¢</button>
  <button class="emo-btn" onclick="quickSay('ğŸ˜¡ Estou zangado')">ğŸ˜¡</button>
  <button class="emo-btn" onclick="quickSay('ğŸ§¡ Quero um abraÃ§o')">ğŸ§¡</button>
  <button onclick="baixarDados()">â¬‡ï¸ Exportar</button>
  <button onclick="document.getElementById('backupFile').click()">â¬†ï¸ Importar</button>
  <input type="file" id="backupFile" style="display:none" onchange="lerBackup(this)">
</footer>

<script>
let perfilAtual = "padrao";
let respostas = {};

function showTab(id) {
  document.querySelectorAll("main.tab").forEach(el => el.style.display="none");
  document.getElementById(id).style.display="block";
}

function carregarRespostas() {
  fetch('/data.json')
    .then(res=>res.json())
    .then(data=>{
      respostas = data[perfilAtual] || {};
      atualizarPainel();
    });
}

function salvarRespostas() {
  fetch('/save',{
    method:'POST',
    headers:{'Content-Type':'application/json'},
    body:JSON.stringify({[perfilAtual]:respostas})
  }).then(()=>carregarRespostas());
}

function addMessage(msg,sender){
  const el=document.createElement('div');
  el.className=sender==='user'?'user-msg':'bot-msg';
  el.textContent=msg;
  document.getElementById('chatBox').appendChild(el);
  document.getElementById('chatBox').scrollTop=document.getElementById('chatBox').scrollHeight;
}

function falar(texto){
  const synth=window.speechSynthesis;
  const utter=new SpeechSynthesisUtterance(texto);
  utter.lang="pt-PT";
  synth.speak(utter);
}

function sendMessage(){
  const input=document.getElementById('userInput');
  const texto=input.value.trim();
  if(!texto) return;
  addMessage('ğŸ‘¤ '+texto,'user');
  if(respostas[texto]){
    addMessage('ğŸ¤– '+respostas[texto],'bot');
    falar(respostas[texto]);
  }else{
    const pergunta='â“ NÃ£o sei responder. Deseja ensinar-me?';
    addMessage(pergunta,'bot');
    setTimeout(()=>{
      const ensino=prompt("Digite a resposta para: "+texto);
      if(ensino){
        respostas[texto]=ensino;
        salvarRespostas();
        addMessage("âœ”ï¸ Aprendi: "+ensino,'bot');
        falar(ensino);
      }
    },500);
  }
  input.value='';
}

function quickSay(texto){document.getElementById('userInput').value=texto; sendMessage();}
function startListening(){
  const SpeechRecognition=window.SpeechRecognition||window.webkitSpeechRecognition;
  if(!SpeechRecognition){alert("Seu navegador nÃ£o suporta voz."); return;}
  const recognition=new SpeechRecognition();
  recognition.lang='pt-PT';
  recognition.onresult=(e)=>{document.getElementById('userInput').value=e.results[0][0].transcript; sendMessage();}
  recognition.start();
}

function trocarPerfil(){
  perfilAtual=document.getElementById('perfilSelect').value;
  carregarRespostas();
}

// ======= Painel de gestÃ£o =======
function atualizarPainel(){
  const tbody=document.querySelector('#knowledgeTable tbody');
  tbody.innerHTML='';
  Object.keys(respostas).forEach(chave=>{
    const tr=document.createElement('tr');
    tr.innerHTML=`<td>${chave}</td><td>${respostas[chave]}</td>
      <td>
        <button class="edit" onclick="editarChave('${chave}')">Editar</button>
        <button class="delete" onclick="excluirChave('${chave}')">Excluir</button>
      </td>`;
    tbody.appendChild(tr);
  });
}

function editarChave(chave){
  const nova=prompt('Editar resposta para: '+chave,respostas[chave]);
  if(nova){
    respostas[chave]=nova;
    salvarRespostas();
  }
}

function excluirChave(chave){
  if(confirm('Excluir "'+chave+'"?')){
    delete respostas[chave];
    salvarRespostas();
  }
}

// Inicializa
carregarRespostas();
</script>
</body>
</html>
