<!DOCTYPE html>
<html lang="pt">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>TECLA Adapta PRIME â€“ Offline</title>
<style>
body {
  margin: 0; font-family: 'Segoe UI', sans-serif; background: #121212; color: #eee;
  display: flex; flex-direction: column; height: 100vh; font-size: 18px;
}
header { background: #1f1f1f; color: #fff; padding: 1rem; text-align: center; }
nav { display:flex; justify-content:space-between; background:#222; padding:0.5rem; flex-wrap:wrap; }
nav button, select { background:transparent; border:none; color:white; padding:0.5rem 1rem; cursor:pointer; border-radius:6px; }
nav button:hover, select:hover { background:#555; }
main { flex:1; padding:1rem; overflow-y:auto; }
.chat-container { display:flex; flex-direction:column; gap:0.5rem; }
.user-msg, .bot-msg { max-width:75%; padding:0.75rem; border-radius:12px; font-size:18px; line-height:1.4; }
.user-msg { align-self:flex-end; background:#3333ff33; }
.bot-msg { align-self:flex-start; background:#00ff0033; }
footer { padding:0.5rem; background:#222; display:flex; gap:0.5rem; flex-wrap:wrap; align-items:center; }
input { flex:1; padding:0.75rem; font-size:1rem; border-radius:6px; border:1px solid #555; background:#1f1f1f; color:#eee; }
button.send, .emo-btn { padding:0.75rem 1rem; background:#0077cc; color:white; border:none; border-radius:6px; cursor:pointer; font-size:1rem; }
.emo-btn { font-size:1.2rem; background:#005fa3; }
button.send:hover, .emo-btn:hover { background:#004f8a; }
table { width:100%; border-collapse:collapse; font-size:14px; }
table th, table td { border:1px solid #555; padding:6px; text-align:left; }
thead { background:#333; }
tbody tr:nth-child(even) { background:#1f1f1f; }
tbody tr:hover { background:#444; }
</style>
</head>
<body>
<header>
<h1>TECLA Adapta PRIME â€“ Offline</h1>
</header>
<nav>
<div>
<button onclick="showTab('chat')">ğŸ’¬ Conversar</button>
<button onclick="showTab('gestao')">ğŸ“š GestÃ£o Conhecimento</button>
</div>
</nav>

<main id="chat" class="tab">
  <div class="chat-container" id="chatBox"></div>
</main>

<main id="gestao" class="tab" style="display:none">
<h2>GestÃ£o do Conhecimento</h2>
<table>
  <thead>
    <tr><th>Chave</th><th>Resposta</th><th>AÃ§Ãµes</th></tr>
  </thead>
  <tbody id="tabelaConhecimento"></tbody>
</table>
</main>

<footer>
<input type="text" id="userInput" placeholder="Digite ou fale aqui..." onkeypress="if(event.key==='Enter') sendMessage()"/>
<button class="send" onclick="sendMessage()">Enviar</button>
<button class="send" onclick="startListening()">ğŸ™ï¸ Falar</button>
<button class="emo-btn" onclick="quickSay('ğŸ™‚ Estou feliz')">ğŸ™‚</button>
<button class="emo-btn" onclick="quickSay('ğŸ˜¢ Estou triste')">ğŸ˜¢</button>
<select id="vozSelect" title="Selecionar voz"></select>
</footer>

<script>
// === INÃCIO DO SCRIPT ===
let respostas = JSON.parse(localStorage.getItem("respostas_tecla_offline")||"{}");
const chatBox = document.getElementById("chatBox");

function showTab(id){
  document.querySelectorAll("main.tab").forEach(el=>el.style.display="none");
  document.getElementById(id).style.display="block";
}

function addMessage(msg,sender){
  const el = document.createElement("div");
  el.className = sender==="user"?"user-msg":"bot-msg";
  el.textContent = msg;
  chatBox.appendChild(el);
  chatBox.scrollTop = chatBox.scrollHeight;
}

function falar(texto){
  const synth = window.speechSynthesis;
  const utter = new SpeechSynthesisUtterance(texto);
  const selectedVoice = document.getElementById("vozSelect").value;
  if(selectedVoice) utter.voice = synth.getVoices().find(v=>v.name===selectedVoice);
  utter.lang="pt-PT";
  synth.speak(utter);
}

function sendMessage(){
  const input = document.getElementById("userInput");
  const texto = input.value.trim().toLowerCase();
  if(!texto) return;
  addMessage("ğŸ‘¤ "+texto,"user");

  if(respostas[texto]){
    addMessage("ğŸ¤– "+respostas[texto].resposta,"bot");
    falar(respostas[texto].resposta);
  } else {
    const pergunta = "â“ NÃ£o sei responder. Deseja ensinar-me?";
    addMessage(pergunta,"bot"); falar(pergunta);
    setTimeout(()=>{
      const ensino = prompt("Digite a resposta para: "+texto);
      if(ensino){
        respostas[texto] = {resposta:ensino,data:new Date().toISOString()};
        localStorage.setItem("respostas_tecla_offline",JSON.stringify(respostas));
        addMessage("âœ”ï¸ Aprendi: "+ensino,"bot");
        falar(ensino);
        atualizarTabela();
      }
    },500);
  }
  input.value="";
}

function quickSay(texto){document.getElementById("userInput").value=texto;sendMessage();}

function startListening(){
  const SpeechRecognition = window.SpeechRecognition||window.webkitSpeechRecognition;
  if(!SpeechRecognition){alert("Seu navegador nÃ£o suporta voz."); return;}
  const recognition = new SpeechRecognition();
  recognition.lang="pt-PT";
  recognition.onresult=(event)=>{document.getElementById("userInput").value=event.results[0][0].transcript;sendMessage();}
  recognition.start();
}

// === Painel de GestÃ£o ===
function atualizarTabela(){
  const tbody = document.getElementById("tabelaConhecimento");
  tbody.innerHTML="";
  Object.keys(respostas).forEach(chave=>{
    const tr=document.createElement("tr");
    const tdChave=document.createElement("td"); tdChave.textContent=chave;
    const tdResp=document.createElement("td"); tdResp.textContent=respostas[chave].resposta;
    const tdAcoes=document.createElement("td");
    const btnEditar=document.createElement("button"); btnEditar.textContent="âœï¸"; btnEditar.onclick=()=>editar(chave);
    const btnExcluir=document.createElement("button"); btnExcluir.textContent="ğŸ—‘ï¸"; btnExcluir.onclick=()=>excluir(chave);
    tdAcoes.appendChild(btnEditar); tdAcoes.appendChild(btnExcluir);
    tr.appendChild(tdChave); tr.appendChild(tdResp); tr.appendChild(tdAcoes);
    tbody.appendChild(tr);
  });
}

function editar(chave){
  const nova = prompt("Editar resposta para: "+chave,respostas[chave].resposta);
  if(nova){
    respostas[chave].resposta = nova;
    localStorage.setItem("respostas_tecla_offline",JSON.stringify(respostas));
    atualizarTabela();
  }
}

function excluir(chave){
  if(confirm("Excluir aprendizado: "+chave+"?")){
    delete respostas[chave];
    localStorage.setItem("respostas_tecla_offline",JSON.stringify(respostas));
    atualizarTabela();
  }
}

// === Vozes ===
function popularVozes(){
  const synth = window.speechSynthesis;
  const select = document.getElementById("vozSelect");
  synth.onvoiceschanged = ()=>{
    select.innerHTML="";
    synth.getVoices().filter(v=>v.lang.includes("pt")).forEach(v=>{
      const opt=document.createElement("option");
      opt.value=v.name; opt.textContent=v.name; select.appendChild(opt);
    });
  };
}
popularVozes();
atualizarTabela();
</script>
</body>
</html>
